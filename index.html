<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drum Practice Game</title>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/game.css">
</head>
<body>
  <div class="container">
    <!-- Header Section -->
    <header>
      <h1>Drum Practice Game</h1>
      <div id="midi-status">
        <span id="midi-indicator" class="status-disconnected">‚óè</span>
        <select id="midi-device-select">
          <option value="">No MIDI device</option>
        </select>
      </div>
    </header>

    <!-- Metronome Section -->
    <section class="metronome-container">
      <canvas id="metronome-canvas" width="300" height="60"></canvas>
      <div class="tempo-display">
        <span id="bpm-display">120</span> BPM
      </div>
      <div class="bpm-controls">
        <button id="bpm-down" class="bpm-btn">-</button>
        <input type="range" id="bpm-slider" min="30" max="200" value="120" step="5">
        <button id="bpm-up" class="bpm-btn">+</button>
      </div>
      <div class="pattern-selector">
        <label for="pattern-select">Pattern:</label>
        <select id="pattern-select">
          <option value="funkydrummer" selected>Funky Drummer (Intro Break)</option>
          <option value="rock">Rock Beat</option>
          <option value="house">House Beat (4-on-the-floor)</option>
          <option value="hiphop">Hip-Hop Break</option>
          <option value="amen">Amen Break</option>
          <option value="funk">Funky Groove</option>
        </select>
        <label for="loop-count">Loops:</label>
        <select id="loop-count">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="4" selected>4</option>
          <option value="8">8</option>
          <option value="16">16</option>
        </select>
      </div>
    </section>

    <!-- Game Canvas Section -->
    <section class="game-container">
      <canvas id="game-canvas" width="800" height="360"></canvas>

      <!-- Countdown Overlay -->
      <div id="countdown-overlay" class="countdown-overlay"></div>

      <!-- Hit Feedback Overlay -->
      <div id="hit-feedback" class="hit-feedback"></div>
    </section>

    <!-- Score Display Section -->
    <section class="score-container">
      <div class="score-card">
        <div class="score-item">
          <label>Score</label>
          <span id="total-score" class="score-value">0</span>
        </div>
        <div class="score-item">
          <label>Combo</label>
          <span id="combo" class="score-value">0</span>
        </div>
        <div class="score-item">
          <label>Accuracy</label>
          <span id="accuracy" class="score-value">100%</span>
        </div>
      </div>

      <!-- Judgment Breakdown -->
      <div class="judgment-stats">
        <div class="judgment-item">
          <span class="judgment-label perfect">Perfect</span>
          <span id="perfect-count">0</span>
        </div>
        <div class="judgment-item">
          <span class="judgment-label good">Good</span>
          <span id="good-count">0</span>
        </div>
        <div class="judgment-item">
          <span class="judgment-label ok">OK</span>
          <span id="ok-count">0</span>
        </div>
        <div class="judgment-item">
          <span class="judgment-label miss">Miss</span>
          <span id="miss-count">0</span>
        </div>
      </div>
    </section>

    <!-- Control Section -->
    <section class="controls-container">
      <button id="game-btn" class="btn btn-primary">
        <span class="btn-icon">&#9658;</span> Start
      </button>
    </section>

    <!-- Completion Panel -->
    <section id="completion-panel" class="completion-panel hidden">
      <h3>Attempt Complete!</h3>
      <div class="final-stats">
        <div class="stat-item">
          <label>Final Score</label>
          <span id="final-score" class="stat-value">0</span>
        </div>
        <div class="stat-item">
          <label>Grade</label>
          <span id="final-grade" class="stat-value grade">-</span>
        </div>
        <div class="stat-item">
          <label>Max Combo</label>
          <span id="final-combo" class="stat-value">0</span>
        </div>
      </div>
    </section>

    <!-- Audio Mixer Section -->
    <section class="mixer-container">
      <h3>Audio Mixer</h3>
      <div class="mixer-controls">
        <div class="mixer-channel">
          <label for="metronome-volume">Metronome</label>
          <input type="range" id="metronome-volume" min="0" max="100" value="50" step="1">
          <span id="metronome-volume-display">50%</span>
        </div>
        <div class="mixer-channel">
          <label for="drums-volume">Practice Track</label>
          <input type="range" id="drums-volume" min="0" max="100" value="70" step="1">
          <span id="drums-volume-display">70%</span>
        </div>
      </div>
    </section>

    <!-- Input Settings Section -->
    <section class="input-settings-container">
      <h3>Input Settings</h3>
      <div class="input-settings-controls">
        <div class="input-setting">
          <label for="debounce-slider">Double-Trigger Filter</label>
          <p class="setting-description">Filter out rapid double-hits from unreliable hardware (kick pedals, etc.)</p>
          <div class="slider-row">
            <span class="slider-label">Off</span>
            <input type="range" id="debounce-slider" min="0" max="100" value="30" step="5">
            <span class="slider-label">100ms</span>
          </div>
          <div class="setting-value">
            <span id="debounce-display">30ms</span>
            <span id="debounce-stats" class="debounce-stats"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- Instructions Section -->
    <section class="instructions-container">
      <h3>Instructions</h3>
      <ol>
        <li>Connect a MIDI drum kit or use your keyboard</li>
        <li>Click "Start" to begin the practice pattern</li>
        <li>Hit the drums in time with the scrolling notes</li>
        <li>Aim for "Perfect" timing to build your combo!</li>
      </ol>

      <div class="drum-mapping">
        <h4>Controls</h4>
        <ul>
          <li><span class="drum-color" style="background: #FF4444;"></span> Kick - A key / MIDI 36</li>
          <li><span class="drum-color" style="background: #44FF44;"></span> Snare - S key / MIDI 38</li>
          <li><span class="drum-color" style="background: #4444FF;"></span> Hi-Hat Closed - K key / MIDI 42</li>
          <li><span class="drum-color" style="background: #FFFF44;"></span> Hi-Hat Open - L key / MIDI 46</li>
          <li><span class="drum-color" style="background: #FF44FF;"></span> Tom 1 - D key / MIDI 48</li>
          <li><span class="drum-color" style="background: #44FFFF;"></span> Tom 2 - J key / MIDI 50</li>
        </ul>
      </div>
    </section>
  </div>

  <!-- Load JavaScript modules -->
  <script type="module" src="js/main.js"></script>
</body>
</html>
