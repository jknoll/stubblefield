<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GrooveLab</title>
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/game.css">
</head>
<body>
  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading patterns...</div>
  </div>

  <div class="container">
    <!-- Header Section -->
    <header>
      <h1>GrooveLab</h1>
      <div class="header-controls">
        <!-- Theme Toggle -->
        <button id="theme-toggle" class="theme-toggle" title="Toggle light/dark mode">üåô</button>
        <!-- User Auth Status -->
        <div id="auth-status" class="auth-status">
          <button id="sign-in-btn" class="btn btn-auth">Sign In</button>
          <div id="user-info" class="user-info hidden">
            <img id="user-avatar" class="user-avatar" alt="User" />
            <span id="user-name">Guest</span>
            <button id="sign-out-btn" class="btn btn-auth-small">Sign Out</button>
          </div>
        </div>
        <!-- MIDI Status -->
        <div id="midi-status">
          <span id="midi-indicator" class="status-disconnected">‚óè</span>
          <select id="midi-device-select">
            <option value="">No MIDI device</option>
          </select>
        </div>
      </div>
    </header>

    <!-- Compact Controls Row -->
    <section class="controls-row">
      <canvas id="metronome-canvas" width="300" height="60" style="display: none;"></canvas>
      <div class="tempo-control">
        <button id="bpm-down" class="bpm-btn">-</button>
        <span class="tempo-display"><span id="bpm-display">120</span> BPM</span>
        <button id="bpm-up" class="bpm-btn">+</button>
      </div>
      <input type="range" id="bpm-slider" min="30" max="200" value="120" step="5">
      <select id="pattern-select">
        <option value="funkydrummer" selected>Funky Drummer (Intro Break)</option>
        <option value="rock">Rock Beat</option>
        <option value="house">House Beat (4-on-the-floor)</option>
        <option value="hiphop">Hip-Hop Break</option>
        <option value="amen">Amen Break</option>
        <option value="funk">Funky Groove</option>
      </select>
      <select id="loop-count">
        <option value="1">1x</option>
        <option value="2">2x</option>
        <option value="4" selected>4x</option>
        <option value="8">8x</option>
        <option value="16">16x</option>
        <option value="infinite">‚àû</option>
      </select>
      <button id="quantize-btn" class="btn btn-small" title="Snap pattern notes to grid">Quantize</button>
    </section>

    <!-- Game Canvas Section -->
    <section class="game-container">
      <canvas id="game-canvas" width="800" height="360"></canvas>

      <!-- Countdown Overlay -->
      <div id="countdown-overlay" class="countdown-overlay"></div>

      <!-- Hit Feedback Overlay -->
      <div id="hit-feedback" class="hit-feedback"></div>
    </section>

    <!-- Control Section -->
    <section class="controls-container">
      <button id="game-btn" class="btn btn-primary">
        <span class="btn-icon">&#9658;</span> Start
      </button>
    </section>

    <!-- Combined Stats and Score Row -->
    <section class="stats-score-row">
      <!-- Progress Tracking (Left) -->
      <div class="stats-panel">
        <div class="stats-header">
          <span id="stats-pattern-name" class="stats-pattern-name"></span>
          <button id="clear-stats-btn" class="btn btn-small btn-danger" title="Clear history">Clear</button>
        </div>
        <canvas id="stats-canvas" width="400" height="150"></canvas>
        <div class="stats-info">
          <span id="stats-session-info">Practice to see your progress</span>
        </div>
      </div>

      <!-- Score Display (Right) -->
      <div class="score-panel">
        <div class="score-card">
          <div class="score-item">
            <label>Score</label>
            <span id="total-score" class="score-value">0</span>
          </div>
          <div class="score-item">
            <label>Combo</label>
            <span id="combo" class="score-value">0</span>
          </div>
          <div class="score-item">
            <label>Accuracy</label>
            <span id="accuracy" class="score-value">100%</span>
          </div>
        </div>
        <div class="judgment-stats">
          <div class="judgment-item">
            <span class="judgment-label perfect">Perfect</span>
            <span id="perfect-count">0</span>
          </div>
          <div class="judgment-item">
            <span class="judgment-label good">Good</span>
            <span id="good-count">0</span>
          </div>
          <div class="judgment-item">
            <span class="judgment-label ok">OK</span>
            <span id="ok-count">0</span>
          </div>
          <div class="judgment-item">
            <span class="judgment-label miss">Miss</span>
            <span id="miss-count">0</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Completion Panel -->
    <section id="completion-panel" class="completion-panel hidden">
      <h3>Attempt Complete!</h3>
      <div class="final-stats">
        <div class="stat-item">
          <label>Final Score</label>
          <span id="final-score" class="stat-value">0</span>
        </div>
        <div class="stat-item">
          <label>Grade</label>
          <span id="final-grade" class="stat-value grade">-</span>
        </div>
        <div class="stat-item">
          <label>Max Combo</label>
          <span id="final-combo" class="stat-value">0</span>
        </div>
      </div>
    </section>

    <!-- Combined Settings Row -->
    <section class="settings-row">
      <div class="setting-group">
        <label for="metronome-volume">Metronome</label>
        <input type="range" id="metronome-volume" min="0" max="100" value="50" step="1">
        <span id="metronome-volume-display">50%</span>
      </div>
      <div class="setting-group">
        <label for="drums-volume">Track</label>
        <input type="range" id="drums-volume" min="0" max="100" value="70" step="1">
        <span id="drums-volume-display">70%</span>
      </div>
      <div class="setting-group debounce-group">
        <label for="debounce-slider">Filter</label>
        <input type="range" id="debounce-slider" min="0" max="100" value="30" step="5">
        <span id="debounce-display">30ms</span>
        <span id="debounce-stats" class="debounce-stats"></span>
      </div>
    </section>

  </div>

  <!-- Firebase SDK (uncomment and configure to enable auth) -->
  <!--
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script>
    // Initialize Firebase with your config
    // Get this from Firebase Console > Project Settings > Your apps
    window.firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
  </script>
  -->

  <!-- Load JavaScript modules -->
  <script type="module" src="js/main.js"></script>
</body>
</html>
